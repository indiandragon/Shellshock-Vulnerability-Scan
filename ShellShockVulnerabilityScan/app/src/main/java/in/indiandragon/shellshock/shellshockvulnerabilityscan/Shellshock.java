/*Copyright (C) 2014  indiandragon

        This program is free software: you can redistribute it and/or modify
        it under the terms of the GNU General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        This program is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU General Public License for more details.

        You should have received a copy of the GNU General Public License
        along with this program.  If not, see <http://www.gnu.org/licenses/>. */

package in.indiandragon.shellshock.shellshockvulnerabilityscan;

import android.os.Bundle;
import android.widget.TextView;
import android.app.Activity;
import android.graphics.Color;

import in.indiandragon.shellshock.shellshockvulnerabilityscan.Shell.*;

public class Shellshock extends Activity {

    TextView prompt;
    TextView status;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_shellshock);
        prompt = (TextView) findViewById(R.id.prompt);
        status = (TextView) findViewById(R.id.status);

        String versionCmd = "bash -version";
        // The exploit
        String shellshockCmd = "env x='() { :; }; echo vulnerable' bash -c ''";

        try {
            String firstLine = Shell.exec(versionCmd).split("\\n")[0];
            boolean searchArrayResult = false;
            searchArrayResult = firstLine.contains("version");

            if (searchArrayResult) {
                prompt.setText(firstLine);

                if (Shell.exec(shellshockCmd).equals("")) {
                    status.setText("No");
                    status.setTextColor(Color.GREEN);
                    prompt.setTextColor(Color.GREEN);
                } else {
                    status.setText("Yes");
                }
            } else {
                // command not executed, so positively we can consider there's
                // no vulnerability
                status.setText("No");
                prompt.setText("No bash found!");
                status.setTextColor(Color.GREEN);
                prompt.setTextColor(Color.GREEN);
            }
        } catch (ShellException e) {
            // process to execute command on shell wasn't executed, so
            // positively we can consider there's no vulnerability
            status.setText("No");
            prompt.setText("No bash found!");
            status.setTextColor(Color.GREEN);
            prompt.setTextColor(Color.GREEN);
        }
    }
}
